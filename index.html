=<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Candlestick Chart Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/brain.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
</head>
<body class="h-full bg-gray-100">
    <div class="flex flex-col h-full p-4">
        <div class="flex-none mb-4">
            <h1 class="text-3xl font-bold text-center text-gray-800">Advanced Candlestick Chart Simulator</h1>
        </div>
        <div id="controls" class="flex-none mb-4 space-x-4 flex justify-center items-center">
            <button id="predictBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                Predict Future
            </button>
            <button id="editModeBtn" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded">
                Toggle Edit Mode
            </button>
            <input type="number" id="futureDays" class="border rounded p-2" placeholder="Days to predict" value="7">
        </div>
        <div id="chart" class="flex-grow"></div>
    </div>

    <script>
        let data = [];
        const totalPoints = 50;
        let lastClose = 100;
        let editMode = false;

        // Generate initial random data
        for (let i = 0; i < totalPoints; i++) {
            const open = lastClose + (Math.random() - 0.5) * 5;
            const close = open + (Math.random() - 0.5) * 5;
            const high = Math.max(open, close) + Math.random() * 2;
            const low = Math.min(open, close) - Math.random() * 2;
            
            data.push({
                x: new Date(2024, 0, i + 1).getTime(),
                y: [open, high, low, close]
            });

            lastClose = close;
        }

        // Initialize chart
        const options = {
            series: [{
                data: data
            }],
            chart: {
                type: 'candlestick',
                height: '100%',
                events: {
                    mouseMove: function(event, chartContext, config) {
                        if (editMode && config.dataPointIndex !== -1) {
                            const newClose = config.globals.series[config.seriesIndex][config.dataPointIndex][4];
                            updateCandlestick(config.dataPointIndex, newClose);
                        }
                    }
                }
            },
            title: {
                text: 'Candlestick Chart',
                align: 'left'
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    formatter: function(val) {
                        return new Date(val).toLocaleDateString();
                    }
                }
            },
            yaxis: {
                tooltip: {
                    enabled: true
                },
                opposite: true
            },
            tooltip: {
                enabled: true,
                custom: function({seriesIndex, dataPointIndex, w}) {
                    const o = w.globals.seriesCandleO[seriesIndex][dataPointIndex];
                    const h = w.globals.seriesCandleH[seriesIndex][dataPointIndex];
                    const l = w.globals.seriesCandleL[seriesIndex][dataPointIndex];
                    const c = w.globals.seriesCandleC[seriesIndex][dataPointIndex];
                    return (
                        '<div class="apexcharts-tooltip-box">' +
                        '<div>Open: ' + o.toFixed(2) + '</div>' +
                        '<div>High: ' + h.toFixed(2) + '</div>' +
                        '<div>Low: ' + l.toFixed(2) + '</div>' +
                        '<div>Close: ' + c.toFixed(2) + '</div>' +
                        '</div>'
                    );
                }
            }
        };

        const chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

        // Initialize brain.js network
        const net = new brain.recurrent.LSTMTimeStep();

        // Predict future prices
        function predictFuture(days) {
            const trainingData = data.map(d => d.y[3]);
            net.train([trainingData], { iterations: 100, log: true });

            let input = trainingData.slice(-5);
            let predictions = [];

            for (let i = 0; i < days; i++) {
                const prediction = net.run(input);
                predictions.push(prediction);
                input = [...input.slice(1), prediction];
            }

            return predictions;
        }

        // Update chart with new candlestick
        function updateCandlestick(index, newClose) {
            data[index].y[3] = newClose;
            data[index].y[1] = Math.max(data[index].y[1], newClose);
            data[index].y[2] = Math.min(data[index].y[2], newClose);
            chart.updateSeries([{ data: data }]);
        }

        // Event listeners
        document.getElementById('predictBtn').addEventListener('click', function() {
            const days = parseInt(document.getElementById('futureDays').value) || 7;
            const predictions = predictFuture(days);
            
            const lastDate = new Date(data[data.length - 1].x);
            const newData = predictions.map((pred, index) => ({
                x: new Date(lastDate.getTime() + (index + 1) * 86400000).getTime(),
                y: [pred, pred + Math.random() * 2, pred - Math.random() * 2, pred]
            }));

            data = [...data, ...newData];
            chart.updateSeries([{ data: data }]);
        });

        document.getElementById('editModeBtn').addEventListener('click', function() {
            editMode = !editMode;
            this.textContent = editMode ? 'Disable Edit Mode' : 'Enable Edit Mode';
            this.classList.toggle('bg-red-500');
            this.classList.toggle('bg-yellow-500');
        });
    </script>
</body>
</html>